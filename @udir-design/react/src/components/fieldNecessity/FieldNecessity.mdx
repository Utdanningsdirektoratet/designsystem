import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as FieldNecessityStories from './FieldNecessity.stories';
import { Field } from '@digdir/designsystemet-react';
import { CssLanguageVariables } from '.storybook/docs/components/CssVariables/CssLanguageVariables';

<Meta of={FieldNecessityStories} />

# FieldNecessity

`FieldNecessity` brukes sammen med input-felter for å automatisk markere skjemafelter som obligatoriske eller valgfrie. Les mer om hvilke felter som må merkes i [bruksmønster for obligatoriske felter](/docs/patterns-obligatoriske-felt--docs).

**Passer til å**

- markere skjemafelter som obligatoriske eller valgfrie

## Slik bruker du FieldNecessity

<Canvas of={FieldNecessityStories.Preview} withToolbar />
<Controls of={FieldNecessityStories.Preview} />

```tsx
import { FieldNecessity } from '@udir-design/react';

<FieldNecessity>
  <Textfield label={<span>Fornavn</span>} required />
  <Textfield label={<span>Etternavn</span>} required />
</FieldNecessity>;
```

Komponenten leser attributtene `required` eller `aria-required` på skjemafeltene du legger inni komponenten for å bestemme hvilken markering som skal vises.

**Legg merke til:** du bør legge en `<span>` rundt `label`-teksten for å få penest mulig resultat. Uten dette
vil du kunne komme i situasjoner der feltmarkeringen får et innrykk når den havner på en egen linje.

## Eksempler

### Oppsummering

Med bakgrunn i bruksmønsteret for obligatoriske felter er standard at markeringen vises som en oppsummering øverst på skjemasiden. Dette forutsetter at alle skjemafelter enten er obligatorske eller valgfrie.

<Canvas of={FieldNecessityStories.AllRequired} />
<Canvas of={FieldNecessityStories.AllOptional} />

Dersom du ikke ønsker å ha oppsumeringen helt øverst, kan du plassere `<FieldNecessity.Summary />` der du ønsker at oppsummeringen skal vises. F.eks. dersom du har en felles beskrivelse av skjemafeltene slik som i eksempelet under.

<Canvas of={FieldNecessityStories.ManualSummaryPlacement} />

### Ett enkelt felt

Når det kun finnes ett felt er det bedre å markere feltet, heller enn å vise oppsummering.
Dette gjør du ved å sette `showSummary={false}` (merk: i eksemplene kommer ikke `showSummary={false}` med i kodevisningen på grunn av en bug i Storybook).

<Canvas of={FieldNecessityStories.SingleRequiredField} />

Dersom det kun finnes ett enkelt felt, og dette er valgfritt, kan man i tillegg vurdere å skru på
markering av valgfri felt med `showOptional={true}`. Dette er kun nødvendig dersom det ikke er åpenbart
fra teksten at feltet er valgfritt.

<Canvas of={FieldNecessityStories.SingleOptionalField} />

### Kombinasjon av obligatoriske og valgfrie felter

Dersom kun noen av feltene på en skjemaside er obligatoriske, markerer vi automatisk disse feltene og skjuler oppsummeringen.

### Markering av Fieldset

Dersom det er obligatorisk å huke av på minst én `Checkbox` eller velge en `Radio` i et `Fieldset` løses dette ved å sette `required` på hver enkelt `Checkbox` eller `Radio`. Den enkleste måten å gjøre det er å sende inn `required: true` som prop til `useCheckboxGroup` eller `useRadioGroup`.

<Canvas of={FieldNecessityStories.FieldsetCheckboxes} />
<Canvas of={FieldNecessityStories.FieldsetRadios} />

### Individuelle checkboxer

I noen tilfeller, slik som i eksempelet under, vil kun enkelte `Checkbox`er være obligatoriske å huke av. Da setter du `required` på de individuelle `Checkbox`ene det gjelder.

<Canvas of={FieldNecessityStories.IndividualCheckboxes} />

### Outline

På noen bakgrunner skiller ikke feltmarkeringen seg like godt ut. I disse tilfellene kan du bruke `variant="outline"`.

<Canvas of={FieldNecessityStories.Outline} />

## Tilgjengelighet

Markeringen av obligatoriske felter er skjult for skjermlesere, siden de allerede leser opp `required` eller `aria-required`. Slik unngår vi å lese dette opp dobbelt.

Dersom man skrur på markering av valgfri felter med `showOptional={true}` vil disse leses opp av skjermleser.

Oppsummeringen vil alltid leses av skjermlesere dersom den er synlig.

## Språkstøtte

Komponenten har innebygget støtte for bokmål og engelsk. [Slik støtter du flere språk](/docs/components-språkstøtte--docs).

Følgende tekstvariabler er tilgjengelige for overstyring:

<CssLanguageVariables
  variables={{
    '--udsc-fieldNecessity-required-text': {
      nb: 'Må fylles ut',
      en: 'Required',
    },
    '--udsc-fieldNecessity-optional-text': {
      nb: 'Valgfritt',
      en: 'Optional',
    },
    '--udsc-fieldNecessity-all-required-text': {
      nb: 'Alle felt må fylles ut',
      en: 'All fields are required',
    },
    '--udsc-fieldNecessity-all-optional-text': {
      nb: 'Alle felt er valgfri',
      en: 'All fields are optional',
    },
  }}
/>
