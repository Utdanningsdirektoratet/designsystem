import { Meta, Canvas, Controls, Primary, ArgTypes } from '@storybook/blocks';
import { Do, Dont, Stack } from '../../../.storybook/docs-components';
import * as CheckboxStories from './Checkbox.stories';
import * as useCheckboxGroupStories from '../../utilities/hooks/useCheckboxGroup/useCheckboxGroup.stories';
import { CheckboxEx1, CheckboxEx2, CheckboxEx3 } from './docs/doAndDont';

<Meta of={CheckboxStories} />

# Checkbox

Vi bruker `Checkbox` (avmerkingsboks) for å gi brukerne valg, der de kan velge ett eller flere alternativer. Brukerne kan både velge og oppheve valgene de gjør. Bruk [`Fieldset`](/docs/components-fieldset--docs) til å gruppere flere valg.

<Primary />
<Controls />

## Slik bruker du checkbox

```tsx
import { Checkbox } from '@udir-design/react';

<Fieldset>
  <Fieldset.Legend>Hva vil du vite mer om?</Fieldset.Legend>
  <Checkbox label="Barnehage" value="barnehage" />
  <Checkbox label="Grunnskole" value="grunnskole" />
  <Checkbox label="Videregående" value="videregaende" />
</Fieldset>;
```

### Kun ett valg

Hvis brukeren skal bekrefte noe, men ikke velge noe, kan en `checkbox` stå alene. For eksempel når brukeren skal samtykke til vilkår.

<Canvas of={CheckboxStories.OneOption} />

### Gruppering av flere valg

Bruk `Fieldset` og `useCheckboxGroup` for gruppering av flere valg.

<Canvas of={CheckboxStories.Group} />

Til `useCheckboxGroup` kan du sende inn:

<ArgTypes of={useCheckboxGroupStories.Default} />

I respons får du objektet:

```ts
{
  getCheckboxProps: (value: string | { allowIndeterminate: true }) => CheckboxProps, // Returnerer props du kan spre på <Checkbox /> eller <input type="checkbox" />
  validationMessageProps: ValidationMessageProps, // Properties du kan valgfritt spre på ValidationMessage
  setValue: string[], // Funksjon for å sette checkbox gruppens verdi
  value: string[], // Nåværende verdi for checkbox gruppen
}
```

Eksempel på bruk:

```tsx
const { getCheckboxProps, validationMessageProps } = useCheckboxGroup({
  name: 'my-checkbox-group',
  value: [''],
  error: 'Du må velge et alternativ',
});

return (
  <Fieldset>
    <Fieldset.Legend>Hva vil du vite mer om?</Fieldset.Legend>
    <Fieldset.Description>
      Velg de alternativene som er relevante for deg.
    </Fieldset.Description>
    <Checkbox
      label="Alle"
      {...getCheckboxProps({ allowIndeterminate: true })}
    />
    <Checkbox label="Barnehage" {...getCheckboxProps('barnehage')} />
    <Checkbox label="Grunnskole" {...getCheckboxProps('grunnskole')} />
    <Checkbox label="Videregående" {...getCheckboxProps('videregaende')} />
    <ValidationMessage {...validationMessageProps} />
  </Fieldset>
);
```

### Velge alle alternativer med en hoved-sjekkboks

Legg inn `allowIndeterminate: true`i `getCheckboxProps` for å opprette en hoved-sjekkboks som både kan velge og fjerne alle alternativer.
Dette aktiverer en ekstra tilstand, `indeterminate`, ved siden av `checked` og `unchecked`. Den vises med en horisontal strek og signaliserer at én eller flere sjekkbokser er markert i gruppen.

<Canvas of={CheckboxStories.InTable} />

### Vise feilmelding

Bruk `error` på `Fieldset` for å vise feilmelding.

Her må du bruke `Fieldset` for å gjøre innholdet tilgjengelig og aktivere riktig stil.

<Canvas of={CheckboxStories.WithError} />

### Kontrollere checkbox utenfra

Bruk `useCheckboxGroup` og `setValue` for å kontrollere hvilke alternativer som er valgt.

<Canvas of={CheckboxStories.Controlled} />

## Retningslinjer for checkbox

**Passer til å**

- velge flere alternativer

**Passer ikke til å**

- velge gjensidig utelukkende alternativer, bruk heller [`Radio`](/docs/components-radio--docs)
- velge mellom flere enn 7 svaralternativer, bruk heller [`Select`](/docs/components-select--docs) eller [`Suggestion`](/docs/components-suggestion--docs)

### Sortering

Alternativene skal som hovedregel sorteres alfabetisk. Velger du å
presentere de mest aktuelle alternativene først kan det bli vanskelig å finne ønsket
alternativ. Du kan også risikere å påvirke svaret, noe som er uheldig.

### Plassering

`Checkbox` skal som hovedregel kun plasseres vertikalt, av hensyn
til lesbarhet. Det er enklere for brukere å skanne listen når alternativene ligger
under hverandre. For brukere som trenger å forstørre (zoome inn) nettsiden for å
se godt nok, er en horisontal liste ekstra vanskelig.

<CheckboxEx1 />

### Ikke bruk deaktiverte checkboxer

Vi unngår deaktiverte (`disabled`) checkboxer fordi de kan være vanskelige å oppfatte. Noen brukere vil ikke forstå hva checkboxen sier eller hvorfor den ikke er klikkbar. Hvis en checkbox eller gruppe med checkboxer ikke er relevant, bør du helst fjerne valgene fremfor å deaktivere dem. Tilby gjerne brukeren informasjon om hvorfor valgene ikke er tilgjengelig.

Nav har en god forklaring på [hvorfor deaktiverte tilstander er problematisk](https://aksel.nav.no/god-praksis/artikler/deaktiverte-tilstander) og hvilke alternativer som finnes.

### Unngå skrivebeskyttede checkboxer

Felter med `readonly`-attributtet er med i tabrekkefølgen. Brukerne kan kopiere innholdet men ikke redigere det. Informasjon blir med når skjemaet sendes inn.

`Readonly`-felter kan være forvirrende for noen brukere. Ikke alle vil skjønne hvorfor de ikke får til å endre innholdet i feltet. Vi anbefaler derfor å unngå readonly så langt det lar seg gjøre.

## Tekst i checkbox

I et skjema er ofte forklaringen formulert som et spørsmål. Vurder om du trenger å ha med informasjon om at brukeren kan velge flere svaralternativer.

Bruk et aktivt og positivt språk. Tenk på innholdet som en samtale. Når `legend`
er en setning, kan du skrive den i du-form og svaralternativene (`label`) i jeg-form.

**Plassering av tekst:**

- `legend` og eventuell `description` plasseres før listen med svaralternativ.
- `label` til hver boks må beskrive alternativet.
- `label` skal stå til høyre for boksen. Hvis det er nødvendig med ekstra beskrivelse, kan du ha en `description` under `label` .
- `label` skal alltid ha stor forbokstav.

### Lag logisk sammenheng mellom forklaringen og svaralternativene

Brukeren skal kunne lese hvert svaralternativ som en logisk respons på forklaringen over boksene.

Eksempel på riktig logisk sammenheng:

<CheckboxEx2 />

### Gi svaralternativene samme språklige form

Det betyr at de kan ha enten fullstendige setninger eller ett ord, ikke begge deler.

<CheckboxEx3 />

## Tilgjengelighet

Det skal være mulig å flytte fokus til `Checkbox`, ved å trykke `Tab` på tastaturet. Det skal være mulig å merke og fjerne avmerking ved å trykke `Space`.

### Bruk label

`Checkbox` skal alltid ha en `label`. Bruker du `label` fra en annen plass, husk da å bruke `aria-label` eller `aria-labelledby` (Se kode under).

<Canvas of={CheckboxStories.AriaLabel} />
